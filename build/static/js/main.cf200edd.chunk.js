(this.webpackJsonpdeckgl=this.webpackJsonpdeckgl||[]).push([[0],{170:function(t,e){},326:function(t,e,a){t.exports=a(363)},331:function(t,e,a){},351:function(t,e){},361:function(t,e,a){},363:function(t,e,a){"use strict";a.r(e);var n=a(1),o=a.n(n),r=a(66),i=a.n(r),l=a(249),c=a(80),s=a(0),u=a(10),d=a(11),p=["Camden","Greenwich","Hackney","Hammersmith and Fulham","Islington","Kensington and Chelsea","Lambeth","Lewisham","Southwark","Tower Hamlets","Wandsworth","Westminster"],h=function(t){var e=t.xScale,a=t.innerHeight,n=t.tickFormat,r=t.tickOffset,i=void 0===r?3:r;return e.ticks().map((function(t){return o.a.createElement("g",{className:"tick",key:t,transform:"translate(".concat(e(t),",0)")},o.a.createElement("line",{y2:a}),o.a.createElement("text",{style:{textAnchor:"middle"},dy:".71em",y:a+i},n(t)))}))},f=function(t){var e=t.yScale,a=t.innerWidth,n=t.tickOffset,r=void 0===n?3:n;return e.ticks().map((function(t){return o.a.createElement("g",{className:"tick",transform:"translate(0,".concat(e(t),")")},o.a.createElement("line",{x2:a}),o.a.createElement("text",{key:t,style:{textAnchor:"end"},x:-r,dy:".32em"},t))}))},m=function(t){var e=t.data,a=t.xScale,n=(t.xValue,t.yScale),o=(t.yValue,t.colorScale),r=(t.colorValue,t.tooltipFormat,t.circleRadius,t.year),i=t.callback,l=t.margin;if(r&&e){var c=function(t){console.log("data:",e);var a=[];return Object.getOwnPropertyNames(e[t]).forEach((function(n){a.push({city:n,data:e[t][n]})})),a}(r+"/"+(r-2e3+1)),s=d.t("svg").selectAll("circle").data(c,(function(t){return t.city}));console.log("enter",s),s.join("circle").attr("stroke","black").transition().duration(1e3).attr("r",(function(t){return parseFloat(t.data.happy)&&parseFloat(t.data.worth)?10*Math.random():0})).attr("cx",(function(t){if(parseFloat(t.data.happy))return a(t.data.happy)+l.left})).attr("cy",(function(t){if(t.data.worth)return n(t.data.worth)+l.top})).attr("fill",(function(t){return o(t.data.Area)})).end().then((function(t){i(),console.log("done")}))}return null},g=function(t){var e=t.colorScale,a=t.tickSpacing,n=void 0===a?20:a,r=(t.tickSize,t.tickTextOffset),i=void 0===r?20:r;t.onHover,t.hoveredValue,t.fadeOpacity;return e.domain().map((function(t,a){return o.a.createElement("g",{className:"tick",transform:"translate(0,".concat(a*n,")")},o.a.createElement("rect",{fill:e(t),width:"10",height:"10",y:-5}),o.a.createElement("text",{x:i,dy:".32em"},t))}))},v=(a(331),{top:20,right:200,bottom:65,left:90}),b=500-v.top-v.bottom,y=960-v.left-v.right,E=Object(d.h)(".2s"),k=function(t){return E(t).replace("G","B")};function x(){var t,e=function(){var t=Object(n.useState)(null),e=Object(u.a)(t,2),a=e[0],o=e[1];return Object(n.useEffect)((function(){console.log("1"),d.d("./happy.csv").then((function(t){var e={};t.map((function(t,a){Object.getOwnPropertyNames(t).map((function(a,n){n>1&&(void 0===e[a]&&(e[a]={}),void 0===e[a][t.Area]&&(e[a][t.Area]={}),e[a][t.Area].happy=t[a],p.indexOf(t.Area.toString())>=0?(console.log("innner"),e[a][t.Area].Area="InnerLondon"):e[a][t.Area].Area="OuterLondon")}))})),d.d("./worthwhile.csv").then((function(t){t.map((function(t,a){Object.getOwnPropertyNames(t).map((function(a,n){n>1&&(void 0===e[a]&&(e[a]={}),void 0===e[a][t.Area]&&(e[a][t.Area]={}),e[a][t.Area].worth=t[a])}))})),o(e)}))}))}),[]),a}(),a=Object(n.useState)(2011),r=Object(u.a)(a,2),i=r[0],l=r[1],c=Object(d.p)().domain([6.8,8.5]).range([0,y]),E=Object(d.p)().domain([8.5,6.8]).range([0,b]),x=Object(d.q)().domain(["InnerLondon","OuterLondon"]).range(["#E6842A","#137B80"]);return o.a.createElement(n.Fragment,null,o.a.createElement("b",null,"time:",o.a.createElement("span",{id:"Time"})),o.a.createElement("svg",{width:960,height:500},o.a.createElement("g",{transform:"translate(".concat(v.left,",").concat(v.top,")")},o.a.createElement(h,{xScale:c,innerHeight:b,tickFormat:k,tickOffset:5}),o.a.createElement("text",{className:"axis-label",textAnchor:"middle",transform:"translate(".concat(-45,",").concat(b/2,") rotate(-90)")},"Worthwhile"),o.a.createElement(f,{yScale:E,innerWidth:y,tickOffset:5}),o.a.createElement("text",{className:"axis-label",x:y/2,y:b+50,textAnchor:"middle"},"Satisfaction"),o.a.createElement("g",{transform:"translate(".concat(y+60,", 60)")},o.a.createElement("text",{x:35,y:-25,className:"axis-label",textAnchor:"middle"},"Area"),o.a.createElement(g,(t={tickSpacing:22,tickSize:10,tickTextOffset:12},Object(s.a)(t,"tickSize",7),Object(s.a)(t,"colorScale",x),t))),o.a.createElement("g",null,o.a.createElement(m,{data:e,xScale:c,xValue:function(t){return t.data.happy},yScale:E,yValue:function(t){return t.data.worth},colorScale:x,colorValue:function(t){return t.species},tooltipFormat:k,circleRadius:7,year:i,margin:v,callback:function(){l(i<2016?i+1:2011),document.getElementById("Time").innerHTML=i+"/"+(i-2e3+1)}})))))}var w=a(3),O=a(2),j=a(6),S=a(4),_=a(7),I=a(393),F=a(387),D=a(96),M=a(243),P=a(383),A=a(175),C=a(401),T=a(395),L=a(399),V=a(8),z=a(78),H=a(258),N=a(403),W=a(398),R=a(27),B=a(134),q=a.n(B),X=a(133),Y=a.n(X),J=(new z.a,Object(H.a)("div",{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2,top:"10px",left:"10px"}),Object(H.a)("div",{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1,bottom:"20px",width:"100%"})),G=Object(H.a)("div",{color:"#00FFFF",position:"absolute",top:"-2em"}),U=Object(H.a)("div",{width:"480px",height:"24px",maxWidth:"80vw"}),Z=function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(j.a)(this,Object(S.a)(e).call(this,t))).state={isPlaying:!1},a._renderThumbValue=a._renderThumbValue.bind(Object(V.a)(a)),a._animate=a._animate.bind(Object(V.a)(a)),a._toggle=a._toggle.bind(Object(V.a)(a)),a._animationFrame=null,a}return Object(_.a)(e,t),Object(O.a)(e,[{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this._animationFrame)}},{key:"_toggle",value:function(){cancelAnimationFrame(this._animationFrame);var t=this.state.isPlaying;t||this._animate(),this.setState({isPlaying:!t})}},{key:"_animate",value:function(){var t=this.props,e=t.min,a=t.max,n=t.value,o=n[1]+10;n[1]>a&&(o=e),this.props.onChange({value:[n[0],o]}),this._animationFrame=requestAnimationFrame(this._animate)}},{key:"_renderThumbValue",value:function(t){var e=t.$thumbIndex,a=t.$value;if(1==e){var n=a[e];return 3600==n&&console.log("thumb==3600"),o.a.createElement(G,{Color:[0,0,0,255]},this.props.formatLabel(n))}return o.a.createElement(G,null)}},{key:"componentDidCatch",value:function(t,e){console.log(t,e)}},{key:"render",value:function(){var t=this.props,e=t.value,a=t.min,n=t.max,r=e[0]>a||e[1]<n;return this.state.hasError?o.a.createElement("h1",null,"Something went wrong."):o.a.createElement(J,null,o.a.createElement(W.a,{shape:R.b.round,size:R.c.compact,disabled:!r,onClick:this._toggle},this.state.isPlaying?o.a.createElement(Y.a,{title:"Stop"}):o.a.createElement(q.a,{title:"Animate"})),o.a.createElement(N.a,Object.assign({},this.props,{overrides:{ThumbValue:this._renderThumbValue,TickBar:function(){return o.a.createElement(U,null)}}})))}}],[{key:"getDerivedStateFromError",value:function(t){return{hasError:!0}}}]),e}(n.PureComponent),$=a(392),K=a(391),Q=a(390),tt=a(366),et=a(49),at=Object(H.a)("div",{position:"absolute",zIndex:1,top:"50px",right:"10px",width:"15%"}),nt=Object(H.a)("div",{position:"absolute",zIndex:1,top:"50px",left:"10px",width:"15%"}),ot=new z.a,rt=[],it=[],lt=[],ct=[],st=[],ut=[],dt=[[128,255,0,255],[255,255,40,255],[255,128,0,255],[255,64,64,255],[255,0,0,255]],pt=new M.a({color:[255,255,255],intensity:1}),ht=new P.a({color:[255,255,255],intensity:2,position:[120.167057,30.185901,8e3]}),ft={buildingColor:[74,80,87],trailColor0:[253,128,93],trailColor1:[23,184,190],material:{ambient:.1,diffuse:.9,shininess:64,specularColor:[60,64,70]},effects:[new A.a({ambientLight:pt,pointLight:ht})]},mt={longitude:120.207057,latitude:30.225901,zoom:11,pitch:45,bearing:0},gt=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]],vt=[];function bt(t){return t*Math.PI/180}var yt=function(t,e){var a=[];return e.forEach((function(e){e+=3600/t,a.push(e)})),a};function Et(t){return new Promise((function(e){d.j("http://localhost:5000/data/"+t).then((function(a){var n=0;d.j("./10.json").then((function(o){var r=[],i=0;a.forEach((function(t){var e=t.split(",");if(-1!=e[0]&&-1!=e[1]&&parseInt(e[2])>=2){st[parseInt(e[0])].out+=parseInt(e[2]),ut[parseInt(e[1])].in+=parseInt(e[2]),n++;var a=e[0]+","+e[1],l=[],c=0,s=[];o[a].path.forEach((function(t){if(0==l.length)l=t;else{var e=function(t,e,a,n){var o=bt(e),r=bt(n),i=o-r,l=bt(t)-bt(a),c=2*Math.asin(Math.sqrt(Math.pow(Math.sin(i/2),2)+Math.cos(o)*Math.cos(r)*Math.pow(Math.sin(l/2),2)));return c*=6378.137,c=Math.round(1e4*c)/1e4}(l[0],l[1],t[0],t[1]);s.push(e),c+=e,l=t}})),c>=i&&(i=c),parseInt(e[2])>=2&&parseInt(e[2])<5?r.push({od:parseInt(e[0])+","+parseInt(e[1]),traffic:parseInt(e[2]),color:0,path:o[a].path,timestamps:s}):parseInt(e[2])>=5&&parseInt(e[2])<20?r.push({od:parseInt(e[0])+","+parseInt(e[1]),traffic:parseInt(e[2]),color:1,path:o[a].path,timestamps:s}):parseInt(e[2])>=20&&parseInt(e[2])<100?r.push({od:parseInt(e[0])+","+parseInt(e[1]),traffic:parseInt(e[2]),color:2,path:o[a].path,timestamps:s}):parseInt(e[2])>=100&&parseInt(e[2])<150?r.push({od:parseInt(e[0])+","+parseInt(e[1]),traffic:parseInt(e[2]),color:3,path:o[a].path,timestamps:s}):parseInt(e[2])>=150&&r.push({od:parseInt(e[0])+","+parseInt(e[1]),traffic:parseInt(e[2]),color:4,path:o[a].path,timestamps:s})}}));var l=[];r.forEach((function(e){var a=[3600*t],n=0;e.timestamps.forEach((function(t){a.push(a[n]+3600/i*t),n++})),e.timestamps=a;for(var o=a,r=0;r<e.traffic;r++)o=yt(e.traffic,o),l.push({od:e.od,traffic:e.traffic,color:e.color,path:e.path,timestamps:o})})),l.forEach((function(t){r.push(t)})),vt=r,console.log("count:",n),console.log("Routes:",vt),e("0")}))}))}))}var kt=new Map,xt=new Map;var wt=new Map,Ot=new Map;var jt=[],St=[],_t=new Map;function It(t){console.log("org",kt);var e=[],a=kt.get(parseInt(t));for(var n in console.log("tmp",a),a)e.push({centroid:it[parseInt(n)],value:a[n]});return e}function Ft(t){var e=[],a=wt.get(parseInt(t));for(var n in console.log("tmp",a),a)e.push({centroid:it[parseInt(n)],value:a[n]});return console.log("data",e),e}var Dt=[],Mt=function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(j.a)(this,Object(S.a)(e).call(this,t))).state={time:0,hour:-1,depV:!1,desV:!1,area:[],options:[],block:!1,pre_org:[],pre_des:[],real_org:[],real:!1,showPredict:!1,blockIcon:[]},a}return Object(_.a)(e,t),Object(O.a)(e,[{key:"componentDidMount",value:function(){d.d("./edge_dep_csv.csv").then((function(t){var e=/([-+]?[0-9]*\.?[0-9]+)/g;console.log("data1:",t),t.forEach((function(t,a){for(var n=t.value.match(e),o=[],r=0;r<n.length-1;r+=2)o.push([parseFloat(n[r+1]),parseFloat(n[r])]);rt.push(o),st.push({contour:o,in:0,out:0,number:a})})),rt.forEach((function(t){var e=0,a=0;t.forEach((function(t){e+=t[0],a+=t[1]})),it.push([e/t.length,a/t.length])})),d.d("./edge_des_csv.csv").then((function(t){var e=/([-+]?[0-9]*\.?[0-9]+)/g;console.log("data2:",t),t.forEach((function(t,a){for(var n=t.value.match(e),o=[],r=0;r<n.length-1;r+=2)o.push([parseFloat(n[r+1]),parseFloat(n[r])]);ct.push(o),ut.push({contour:o,in:0,out:0,number:a})})),ct.forEach((function(t){var e=0,a=0;t.forEach((function(t){e+=t[0],a+=t[1]})),lt.push([e/t.length,a/t.length])}))}))})),new Promise((function(t){d.d("./Traffic_Predict_Data/prediction1-origin.csv").then((function(e){e.map((function(t,e){var a=new Date(t.DepTime).getHours();kt.has(a)||kt.set(a,{}),kt.get(a)[t.Origin]=t.Trips})),d.d("./Traffic_Predict_Data/prediction2-dep.csv").then((function(e){e.map((function(t,e){var a=new Date(t.DepTime).getHours();xt.has(a)||xt.set(a,{}),xt.get(a)[t.Destination]=t.Trips})),t()}))}))})).then(function(){}.bind(this)),d.d("./Traffic_Predict_Data/origin.csv").then((function(t){t.map((function(t,e){var a=new Date(t.DepTime).getHours();wt.has(a)||wt.set(a,{}),wt.get(a)[t.Origin]=t.Trips})),d.d("./Traffic_Predict_Data/destination.csv").then((function(t){t.map((function(t,e){var a=new Date(t.DepTime).getHours();Ot.has(a)||Ot.set(a,{}),Ot.get(a)[t.Destination]=t.Trips}))}))})),new Promise((function(t){d.d("./blockdetect/GPS_588_merge.csv").then((function(e){console.log(e);var a=[],n=[];e.map((function(t,e){var o=new Date(t.date),r=o.getHours(),i=o.getMinutes(),l=3600*r+60*i+o.getSeconds();-1===St.indexOf(l)&&i%5===0&&(i++,St.push(l),n.push(l),a.push([parseFloat(t.Long),parseFloat(t.Lat)]),i%1===0&&_t.set(l,[parseFloat(t.Long),parseFloat(t.Lat)]))})),jt.push({path:a,timestamps:n,color:0}),t()}))})).then(function(){console.log("blockRoute",jt),this.setState({blockRoute:jt})}.bind(this))}},{key:"componentWillUnmount",value:function(){}},{key:"_renderTooltipDep",value:function(){var t=this.state||{},e=t.depObject,a=t.depX,n=t.depY;return e&&o.a.createElement("div",{className:"tooltip",style:{color:"#00ffff",position:"absolute",zIndex:1,pointerEvents:"none",left:a,top:n}},o.a.createElement("div",null,o.a.createElement("b",null,"\u533a\u57df id: "),o.a.createElement("span",null,e.number)),o.a.createElement("div",null,o.a.createElement("b",null,"\u9a76\u51fa\u6d41\u91cf: "),o.a.createElement("span",null,e.out)))}},{key:"_renderTooltipDes",value:function(){var t=this.state||{},e=t.desObject,a=t.desX,n=t.desY;return e&&o.a.createElement("div",{className:"tooltip",style:{color:"#00ffff",position:"absolute",zIndex:1,pointerEvents:"none",left:a,top:n}},o.a.createElement("div",null,o.a.createElement("b",null,"\u533a\u57df: "),o.a.createElement("span",null,e.number)),o.a.createElement("div",null,o.a.createElement("b",null,"\u9a76\u5165\u6d41\u91cf: "),o.a.createElement("span",null,e.in)))}},{key:"_getPredictData",value:function(){return this.state.showPredict?this.state.real?this.state.real_org:this.state.pre_org:[{centroid:[0,0],value:[0,0]}]}},{key:"_renderLayers",value:function(){var t=this,e=this.props,a=e.trailLength,n=void 0===a?120:a;e.theme;return[new C.a({id:"scatterplot-layer",data:this.state.blockIcon,pickable:!0,opacity:.8,stroked:!0,filled:!0,radiusScale:6,radiusMinPixels:1,radiusMaxPixels:100,lineWidthMinPixels:1,getPosition:function(t){return t.coordinates},getRadius:function(t){return 20},getFillColor:function(t){return[255,140,0]},getLineColor:function(t){return[0,0,0]},visible:this.state.block}),new F.a({id:"blockRoute",data:this.state.blockRoute,getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},getColor:[0,140,255,255],opacity:.3,widthMinPixels:5,rounded:!0,trailLength:1200,currentTime:this.state.time,shadowEnabled:!1,pickable:!0,visible:this.state.block}),new F.a({id:"trips",data:this.state.Route,getPath:function(t){return t.path},getTimestamps:function(t){return t.timestamps},getColor:function(t){return dt[t.color]},opacity:.3,widthMinPixels:2,rounded:!0,trailLength:n,currentTime:this.state.time,shadowEnabled:!1,pickable:!0,visible:this.state.showRoute}),new T.a({id:"dep_polygon",data:this.state.depPolygon,pickable:!0,stroked:!0,filled:!0,wireframe:!0,lineWidthMinPixels:1,getPolygon:function(t){return t.contour},getFillColor:function(t){return[255,255,0,50]},getLineColor:[80,80,80],getLineWidth:1,onHover:function(e){return t.setState({depObject:e.object,depX:e.x,depY:e.y})},visible:this.state.depV}),new T.a({id:"des_polygon",data:this.state.desPolygon,pickable:!0,stroked:!0,filled:!0,wireframe:!0,lineWidthMinPixels:1,getPolygon:function(t){return t.contour},getFillColor:function(t){return[255,0,0,50]},getLineColor:[80,80,80],getLineWidth:1,onHover:function(e){return t.setState({desObject:e.object,desX:e.x,desY:e.y})},visible:this.state.desV}),new L.a({id:"predict-origin-layer",data:this._getPredictData(),diskResolution:12,radius:100,extruded:!0,pickable:!0,elevationScale:5e3,getPosition:function(t){return t.centroid},getFillColor:function(t){var e=(Math.log(t.value)/Math.log(4)).toFixed(0);return e<=5?gt[e]:gt[5]},getLineColor:[0,0,0],getElevation:function(t){return parseInt(t.value)/100},transitions:{getElevation:{duration:3e3,enter:function(t){for(var e=[],a=0;a<300;a++)e.push(t[0]*a/300);return e}}},updateTriggers:{getElevation:[this.state.pre_org,this.state.real_org]}})]}},{key:"_formatLabel",value:function(t){return"".concat(Math.floor(t/3600),":").concat(Math.floor(t%3600/60),":").concat(Math.floor(t%3600%60))}},{key:"render",value:function(){var t=this,e=this.props,a=e.viewState,r=e.mapStyle,i=void 0===r?"mapbox://styles/mapbox/dark-v9":r,l=e.theme,c=void 0===l?ft:l;return o.a.createElement(n.Fragment,null,o.a.createElement(I.a,{layers:this._renderLayers(),effects:c.effects,initialViewState:mt,viewState:a,controller:!0},o.a.createElement(D.a,{reuseMaps:!0,mapStyle:i,preventStyleDiffing:!0,mapboxApiAccessToken:"pk.eyJ1IjoiemhpZ3VhbmdkYSIsImEiOiJjanozdXg0b3EwMHh4M21tcXk2MHlpN3B1In0.lInf8zFl2BsP_bDjMFhf3w"})),this._renderTooltipDep(),this._renderTooltipDes(),o.a.createElement(et.Provider,{value:ot},o.a.createElement(Q.a,{theme:tt.a},o.a.createElement(Z,{min:0,max:86400,value:[0,this.state.time],formatLabel:this._formatLabel,onChange:function(e){var a=e.value[1];if(_t.has(a)){console.log("icon"),Dt.push({coordinates:_t.get(a)});var n=[];Dt.forEach((function(t){n.push(t)})),console.log("set"),t.setState({blockIcon:n}),console.log(t.state.blockIcon)}if(Math.floor(a/3600)!==t.state.hour){t.setState({hour:Math.floor(a/3600)}),console.log("nowztime:",a);var o=(a/3600).toFixed(0);console.log("hour:",o),t.setState({pre_org:It(o),real_org:Ft(o)}),Et(o).then(function(){console.log("Route",vt),this.setState({Route:vt,depPolygon:st,desPolygon:ut})}.bind(t))}t.setState({time:a})}}),o.a.createElement(at,null,o.a.createElement($.a,{id:"area",options:[{label:"\u51fa\u53d1\u533a\u57df",id:"dep_polygon"},{label:"\u5230\u8fbe\u533a\u57df",id:"des_polygon"},{label:"\u9690\u85cf",id:""}],value:this.state.area,placeholder:"\u663e\u793a\u533a\u57df",size:K.a.mini,onChange:function(e){null!=e.option?"dep_polygon"==e.option.id?(console.log(),t.setState({depPolygon:st,depV:!0,desV:!1,area:[{label:"\u51fa\u53d1\u533a\u57df",id:"dep_polygon"}]})):"des_polygon"==e.option.id?(console.log("desPolygon",t.state.desPolygon),t.setState({desPolygon:ut,desV:!0,depV:!1,area:[{label:"\u5230\u8fbe\u533a\u57df",id:"des_polygon"}]})):t.setState({desV:!1,depV:!1,area:[{label:"\u9690\u85cf",id:""}]}):t.setState({area:[],desV:!1,depV:!1})}})),o.a.createElement(nt,null,o.a.createElement($.a,{id:"option",options:[{label:"\u663e\u793a\u8f68\u8ff9",id:"route"},{label:"\u9884\u6d4b\u6d41\u91cf",id:"predict"},{label:"\u5b9e\u9645\u6d41\u91cf",id:"real"},{label:"\u8def\u969c\u68c0\u6d4b",id:"block"}],value:this.state.options,placeholder:"\u9009\u62e9\u670d\u52a1",size:K.a.mini,onChange:function(e){null!==e.option&&("predict"===e.option.id?t.setState({real:!1,options:[{label:"\u9884\u6d4b\u6d41\u91cf",id:"predict"}],showPredict:!0}):"real"===e.option.id?t.setState({real:!0,options:[{label:"\u5b9e\u9645\u6d41\u91cf",id:"real"}],showPredict:!0}):"block"===e.option.id?t.setState({block:!0,options:[{label:"\u8def\u969c\u68c0\u6d4b",id:"block"}],time:45466,showPredict:!1,showRoute:!1}):"route"===e.option.id&&t.setState({block:!1,options:[{label:"\u663e\u793a\u8f68\u8ff9",id:"route"}],showRoute:!0}))}})))))}}]),e}(n.Component),Pt=a(402),At=a(255),Ct=new z.a,Tt=(Object(H.a)("div",{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2,top:"10px",left:"10px"}),Object(H.a)("div",{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1,bottom:"20px",width:"100%"})),Lt=Object(H.a)("div",{color:"#000000",position:"absolute",top:"-2em"}),Vt=Object(H.a)("div",{width:"480px",height:"20px",maxWidth:"80vw"}),zt=0,Ht=function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(j.a)(this,Object(S.a)(e).call(this,t))).state={isPlaying:!1},a._renderThumbValue=a._renderThumbValue.bind(Object(V.a)(a)),a._animate=a._animate.bind(Object(V.a)(a)),a._toggle=a._toggle.bind(Object(V.a)(a)),a._animationFrame=null,a}return Object(_.a)(e,t),Object(O.a)(e,[{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this._animationFrame)}},{key:"_toggle",value:function(){cancelAnimationFrame(this._animationFrame);var t=this.state.isPlaying;t||this._animate(),this.setState({isPlaying:!t})}},{key:"_animate",value:function(){if(2===++zt){var t=this.props,e=t.max,a=t.value,n=a[1]+1>e?0:a[1]+1,o=new Date("2020-01-22");o.setDate(o.getDate()+a[1]),console.log("mounth:",o.getMonth());var r="".concat(o.getFullYear(),"-").concat(o.getMonth()+1<10?"0"+(o.getMonth()+1):o.getMonth()+1,"-").concat(o.getDate()<10?"0"+o.getDate():o.getDate());console.log("tmpstr:",r),this.props.onChange({date:r,value:[0,n]}),zt=0}this._animationFrame=requestAnimationFrame(this._animate)}},{key:"_renderThumbValue",value:function(t){var e=t.$thumbIndex,a=t.$value;if(1==e){var n=a[e];return o.a.createElement(Lt,{Color:[0,0,0,255]},this.props.formatLabel(n))}return o.a.createElement(Lt,null)}},{key:"render",value:function(){var t=this.props,e=t.value,a=t.min,n=t.max,r=e[0]>a||e[1]<n;return this.state.hasError?o.a.createElement("h1",null,"Something went wrong."):o.a.createElement(et.Provider,{value:Ct},o.a.createElement(Q.a,{theme:tt.a},o.a.createElement(Tt,null,o.a.createElement(W.a,{shape:R.b.round,size:R.c.compact,disabled:!r,onClick:this._toggle},this.state.isPlaying?o.a.createElement(Y.a,{title:"Stop"}):o.a.createElement(q.a,{title:"Animate"})),o.a.createElement(N.a,Object.assign({},this.props,{overrides:{ThumbValue:this._renderThumbValue,TickBar:function(){return o.a.createElement(Vt,null)}}})))))}}]),e}(n.PureComponent),Nt=a(394),Wt=new At.a({farZMultiplier:100}),Rt=-1,Bt=new Map;var qt={longitude:120.207057,latitude:30.225901,zoom:3,pitch:0,bearing:0},Xt=(new Pt.a({filterSize:1}),function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(j.a)(this,Object(S.a)(e).call(this,t))).state={pointData:[],days:39,dayCount:0},a}return Object(_.a)(e,t),Object(O.a)(e,[{key:"_renderLayers",value:function(){return[new Nt.a({id:"heatmap",data:this.state.pointData,getPosition:function(t){return t.coordinate},getWeight:10,radiusPixels:20})]}},{key:"_formatLabel",value:function(t){var e=new Date("2020-01-22");return e.setDate(e.getDate()+t),"".concat(e.getFullYear(),"/").concat(e.getMonth()+1,"/").concat(e.getDate())}},{key:"render",value:function(){var t=this,e=this.props.mapStyle,a=void 0===e?"mapbox://styles/mapbox/light-v9":e;return o.a.createElement(n.Fragment,null,o.a.createElement(I.a,{views:Wt,layers:this._renderLayers(),initialViewState:qt,controller:!0},o.a.createElement(D.a,{reuseMaps:!0,mapStyle:a,preventStyleDiffing:!0,mapboxApiAccessToken:"pk.eyJ1IjoiemhpZ3VhbmdkYSIsImEiOiJjanozdXg0b3EwMHh4M21tcXk2MHlpN3B1In0.lInf8zFl2BsP_bDjMFhf3w"})),o.a.createElement(Ht,{min:0,max:this.state.days,value:[0,this.state.dayCount],formatLabel:this._formatLabel,onChange:function(e){var a=e.date,n=e.value;if(console.log("value:",n),-1===Rt){var o=new Promise((function(t){d.d("./COVID19_open_line_list.csv").then((function(e){e.forEach((function(t){var e=t.date_confirmation.split("."),a=e[2]+"-"+e[1]+"-"+e[0];Bt.has(a)?Bt.get(a).push([t.longitude,t.latitude]):Bt.set(a,[])})),t("done")}))}));console.log(Bt),o.then((function(e){var o=[];Bt.has(a)&&(Bt.get(a).forEach((function(t){console.log(t),o.push({coordinate:[parseFloat(t[0]),parseFloat(t[1])]})})),t.setState({pointData:o,dayCount:n[1]})),Rt=0}))}else{var r=[];Bt.has(a)&&(Bt.get(a).forEach((function(t){r.push({coordinate:[parseFloat(t[0]),parseFloat(t[1])]})})),t.setState({pointData:r})),t.setState({dayCount:n[1]}),console.log(t.state.pointData)}}}))}}]),e}(n.Component)),Yt=Object(H.a)("div",{position:"absolute",zIndex:1,top:"50px",right:"10px",width:"20%",height:"10%"}),Jt=new z.a,Gt=new M.a({color:[255,255,255],intensity:1}),Ut=new P.a({color:[255,255,255],intensity:1,position:[0,0,8e4]}),Zt=new P.a({color:[255,255,255],intensity:1,position:[180,0,8e4]}),$t=new A.a({ambientLight:Gt,pointLight1:Ut,pointLight2:Zt}),Kt=new Map;var Qt={longitude:120.207057,latitude:30.225901,zoom:3,pitch:45,bearing:0},te=[[1,152,189],[73,227,206],[216,254,181],[254,237,177],[254,173,84],[209,55,78]],ee=function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(j.a)(this,Object(S.a)(e).call(this,t))).state={data:[]},a}return Object(_.a)(e,t),Object(O.a)(e,null,[{key:"defaultColorRange",get:function(){return te}}]),Object(O.a)(e,[{key:"componentDidMount",value:function(){var t=this;new Promise((function(t){d.j("./air.json").then((function(e){console.log(e),e.results.forEach((function(t){t.coordinates&&t.measurements.forEach((function(e){Kt.has(e.parameter)?Kt.get(e.parameter).push({centroid:[t.coordinates.longitude,t.coordinates.latitude],value:e.value}):Kt.set(e.parameter,[{centroid:[t.coordinates.longitude,t.coordinates.latitude],value:e.value}])}))})),t("0")}))})).then((function(e){t.setState({data:[]}),console.log("qualityMap:",Kt)}))}},{key:"_renderLayers",value:function(){return[new L.a({id:"column-layer",data:this.state.data,diskResolution:12,radius:5e3,extruded:!0,pickable:!0,elevationScale:5e3,getPosition:function(t){return t.centroid},getFillColor:function(t){var e=(Math.log(t.value)/Math.log(4)).toFixed(0);return e<=5?te[e]:te[5]},getLineColor:[0,0,0],getElevation:function(t){return t.value},transitions:{getElevation:{duration:3e3,enter:function(t){console.log(t);for(var e=[],a=0;a<300;a++)e.push(t[0]*a/300);return console.log(e),e}}},updateTriggers:{getElevation:[this.state.data]}})]}},{key:"render",value:function(){var t=this,e=this.props.mapStyle,a=void 0===e?"mapbox://styles/mapbox/dark-v9":e;return o.a.createElement(n.Fragment,null,o.a.createElement(I.a,{layers:this._renderLayers(),effects:[$t],initialViewState:Qt,controller:!0},o.a.createElement(D.a,{reuseMaps:!0,mapStyle:a,preventStyleDiffing:!0,mapboxApiAccessToken:"pk.eyJ1IjoiemhpZ3VhbmdkYSIsImEiOiJjanozdXg0b3EwMHh4M21tcXk2MHlpN3B1In0.lInf8zFl2BsP_bDjMFhf3w"})),o.a.createElement(et.Provider,{value:Jt},o.a.createElement(Q.a,{theme:tt.a},o.a.createElement(Yt,null,o.a.createElement($.a,{options:[{label:"pm10",id:"pm10"},{label:"pm25",id:"pm25"},{label:"co",id:"co"},{label:"no2",id:"no2"},{label:"so2",id:"so2"},{label:"o3",id:"o3"},{label:"bc",id:"bc"}],value:this.state.label,placeholder:"\u9009\u62e9\u6c61\u67d3\u7c7b\u578b",size:K.a.mini,clearable:!0,onChange:function(e){t.setState({data:Kt.get(e.option.id),label:{label:e.option.label,id:e.option.id}})}})))))}}]),e}(n.Component);a(361);var ae=function(t){var e=t.data,a=t.xScale,n=t.xValue,o=t.yScale,r=t.innerHeight,i=t.innerWidth,l=t.margin,c=t.keys,s=t.start,u=t.callback,p=d.t("svg"),h=d.u().offset(d.w).order(d.x),f=d.q().range(d.s),m=d.a().x((function(t){return a(n(t.data))+l.left})).y0((function(t){return o(t[0])+l.top})).y1((function(t){return o(t[1])+l.top})).curve(d.e);if(e){e=e.slice(s,s+24),h.keys(c);var g=h(e);f.domain(d.o(c.length)),a.domain(d.g(e,n)).range([0,i]),o.domain([d.m(g,(function(t){return d.m(t,(function(t){return t[0]}))})),d.l(g,(function(t){return d.l(t,(function(t){return t[1]}))}))]).range([r,0]),p.selectAll("path").data(g).join("path").attr("fill",(function(t){return d.i(c.indexOf(t.key)/8)})).attr("stroke",(function(t){return d.i(c.indexOf(t[0].data[t.index]/8))})).transition().duration(2e3).attr("d",m).end().then((function(t){u()}))}return null},ne={top:20,right:200,bottom:65,left:150},oe=960-ne.right-ne.left,re=500-ne.top-ne.bottom,ie=d.h(".2s"),le=function(t){return ie(t).replace("G","B")};function ce(){var t,e=function(t){var e=Object(n.useState)(null),a=Object(u.a)(e,2),o=a[0],r=a[1],i=Object(n.useState)(null),l=Object(u.a)(i,2),c=l[0],s=l[1];return Object(n.useEffect)((function(){d.d("./data-city-oneweek.csv").then((function(t){var e=[];t.forEach((function(t){-1===e.indexOf(t.city)&&e.push(t.city)})),s(e);var a=d.n().key((function(t){return t.timestamp})).entries(t),n=[];a.forEach((function(t){var e={};e.date=t.key,t.values.forEach((function(t){e[t.city]=t.light})),n.push(e)})),console.log("tmpD",n),n.slice(5,19).forEach((function(t){console.log(t.date),console.log(new Date(t.date).getHours()),console.log(new Date(t.date))})),r(n)}))}),[]),[o,c]}(),a=Object(u.a)(e,2),r=a[0],i=a[1],l=Object(n.useState)(19),c=Object(u.a)(l,2),p=c[0],f=c[1],m=d.p(),v=d.p(),b=d.q(),y=[];return i&&(i.forEach((function(t,e){y.push(d.i(e/8))})),b.domain(i).range(y)),o.a.createElement("div",{className:"stream"},o.a.createElement("svg",{height:500,width:960},o.a.createElement("g",{transform:"translate(".concat(ne.left,",").concat(ne.top,")")},o.a.createElement("g",{transform:"translate(".concat(oe+60,", 60)")},o.a.createElement("text",{x:35,y:-25,className:"axis-label",textAnchor:"middle",style:{fill:"#FFFFFF"}},"city"),o.a.createElement(g,(t={tickSpacing:22,tickSize:10,tickTextOffset:12},Object(s.a)(t,"tickSize",7),Object(s.a)(t,"colorScale",b),t))),o.a.createElement(ae,{data:r,start:p,keys:i,xScale:m,xValue:function(t){return new Date(t.date).getHours()},yScale:v,margin:ne,innerHeight:re,innerWidth:oe,callback:function(){p+24<139?(console.log(r.length,p+24),f(p+24)):f(19)}}),o.a.createElement(h,{xScale:m,innerHeight:re,tickFormat:le,tickOffset:2}),o.a.createElement("text",{className:"axis-label",textAnchor:"middle",transform:"translate(".concat(-70,",").concat(re/2,") rotate(-90)")},"Light"),o.a.createElement("text",{className:"axis-label",x:oe/2,y:re+50,textAnchor:"middle"},"Time"))))}var se=function(t){var e=t.data,a=t.xScale,n=t.xValue,o=t.yScale,r=t.innerHeight,i=t.innerWidth,l=t.margin,c=t.keys,s=(t.start,t.callback,d.t("svg")),u=d.u().offset(d.v).order(d.x),p=d.q().range(d.s);d.a().x((function(t){return a(n(t.data))+l.left})).y0((function(t){return o(t[0])+l.top})).y1((function(t){return o(t[1])+l.top})).curve(d.e);if(e){e=e.slice(19,139),u.keys(c);var h=u(e);p.domain(d.o(c.length)),a.domain(d.g(e,n)).range([0,i]),o.domain([d.m(h,(function(t){return d.m(t,(function(t){return t[0]}))})),d.l(h,(function(t){return d.l(t,(function(t){return t[1]}))}))]).range([r,0]);var f=[];h.map((function(t){t.map((function(e,a){e.key=t.key,void 0===f[a]&&(f[a]=[]),f[a].push(e)}))}));s.append("g");var m=s.append("g"),g=0,v=[],b=[],y=[];!function t(){var e=0;b.unshift(f[g].length),b.length>24&&(e=b.pop()),f[g].forEach((function(t){t.count=g,v.unshift(t)})),y.unshift(f[g]),y.length>24&&y.pop();m.selectAll("g").data(y).enter().append("g");var r=m.selectAll("g").selectAll("rect").data((function(t){return t})).join((function(t){return t.append("rect").attr("fill",(function(t){return d.i(c.indexOf(t.key)/8)})).attr("x",(function(t){return a(n(t.data))+l.left-5})).attr("y",(function(t){return o(t[1])+l.top})).attr("height",(function(t){return o(t[0])-o(t[1])}))}),(function(t){return t}));r.filter((function(t,e){return 0===n(t.data)})).attr("fill",(function(t){return d.i(c.indexOf(t.key)/8)})).attr("x",(function(t){return a(n(t.data))+l.left-5})).attr("y",(function(t){return o(t[1])+l.top})).attr("width",0);var i=r.transition().duration(1e3).attr("fill",(function(t){return d.i(c.indexOf(t.key)/8)})).attr("x",(function(t){return a(n(t.data))+l.left-5})).attr("y",(function(t){return o(t[1])+l.top})).attr("height",(function(t){return o(t[0])-o(t[1])})).attr("width",10).end(),s=m.selectAll("g").selectAll("text").data((function(t){return t})).join("text").text((function(t,e,a){return 6===e?function(t){var e=new Date(t.date),a=e.getHours();return e.getDate()+"/"+a+":00"}(t.data):null})).attr("dy",".2em").attr("font-size","8");s.filter((function(t){return 0===n(t.data)})).attr("x",(function(t){return a(n(t.data))+l.left-12})).attr("y",(function(t){return o(t[1])+l.top})),s.transition().duration(1e3).attr("x",(function(t){return a(n(t.data))+l.left-12})).attr("y",(function(t){return o(t[1])+l.top}));for(var u=0;u<e;u++)v.pop();var p=[];v.forEach((function(t,e){var a=[t[0],t[1]];a.data=t.data,a.key=t.key,a.n=e,a.count=t.count,p.push(a)})),console.log("t.len",p.length),i.then((function(){g<f.length-1&&(g++,t())}))}()}return null},ue={top:20,right:200,bottom:65,left:150},de=960-ue.right-ue.left,pe=500-ue.top-ue.bottom,he=d.h(".2s"),fe=function(t){return he(t).replace("G","B")};function me(){var t,e=function(t){var e=Object(n.useState)(null),a=Object(u.a)(e,2),o=a[0],r=a[1],i=Object(n.useState)(null),l=Object(u.a)(i,2),c=l[0],s=l[1];return Object(n.useEffect)((function(){d.d("./data-city-oneweek.csv").then((function(t){var e=[];t.forEach((function(t){-1===e.indexOf(t.city)&&e.push(t.city)})),s(e);var a=d.n().key((function(t){return t.timestamp})).entries(t),n=[];a.forEach((function(t){var e={};e.date=t.key,t.values.forEach((function(t){e[t.city]=t.light})),n.push(e)})),console.log("tmpD",n),n.slice(5,19).forEach((function(t){console.log(t.date),console.log(new Date(t.date).getHours()),console.log(new Date(t.date))})),r(n)}))}),[]),[o,c]}(),a=Object(u.a)(e,2),r=a[0],i=a[1],l=Object(n.useState)(19),c=Object(u.a)(l,2),p=c[0],f=c[1],m=d.p(),v=d.p(),b=d.q(),y=[];return i&&(i.forEach((function(t,e){y.push(d.i(e/8))})),b.domain(i).range(y)),o.a.createElement(n.Fragment,null,o.a.createElement("svg",{height:500,width:960},o.a.createElement("g",{transform:"translate(".concat(ue.left,",").concat(ue.top,")")},o.a.createElement("g",{transform:"translate(".concat(de+60,", 60)")},o.a.createElement("text",{x:35,y:-25,className:"axis-label",textAnchor:"middle"},"city"),o.a.createElement(g,(t={tickSpacing:22,tickSize:10,tickTextOffset:12},Object(s.a)(t,"tickSize",7),Object(s.a)(t,"colorScale",b),t))),o.a.createElement(se,{data:r,start:p,keys:i,xScale:m,xValue:function(t){return new Date(t.date).getHours()},yScale:v,margin:ue,innerHeight:pe,innerWidth:de,callback:function(){p+24<139?(console.log(r.length,p+24),f(p+24)):f(19)}}),o.a.createElement(h,{xScale:m,innerHeight:pe,tickFormat:fe,tickOffset:2}),o.a.createElement("text",{className:"axis-label",textAnchor:"middle",transform:"translate(".concat(-70,",").concat(pe/2,") rotate(-90)")},"Light"),o.a.createElement("text",{className:"axis-label",x:de/2,y:pe+50,textAnchor:"middle"},"Time"))))}var ge=20,ve=150,be=960-200-ve,ye=500-ge-65,Ee=["China","US"],ke=d.p().domain([0,1e5]).range([ye,0]),xe=d.c(ke),we=[new Date(2020,0,22),new Date(2020,4,1)],Oe=d.r().domain(we).range([0,be]),je=d.b(),Se=new Map,_e=[],Ie=(new Map,[]);var Fe=d.k().x((function(t){return Oe(t[0])})).y((function(t){return ke(t[1])}));var De=function(t){function e(t){var a;return Object(w.a)(this,e),(a=Object(j.a)(this,Object(S.a)(e).call(this,t))).state={day:0,linedata:[]},a}return Object(_.a)(e,t),Object(O.a)(e,[{key:"componentDidMount",value:function(){var t=this,e=[];new Promise((function(t){d.d("./covid/time_series_covid19_confirmed_global.csv").then((function(e){e.map((function(t,e){for(var a in t)new Date(a).getDate()&&(t[a]=parseInt(t[a]));if(Se.has(t["Country/Region"])){var n=Se.get(t["Country/Region"]);for(var o in n)new Date(o).getDate()&&(-1===_e.indexOf(o)&&_e.push(o),n[o]=n[o]+t[o])}else Se.set(t["Country/Region"],t)})),console.log(Se),Ee.forEach((function(t){var e={country:t,path:[]};for(var a in Se.get(t)){var n=new Date(a);n.getDate()&&(new Date(n.getFullYear(),n.getMonth(),n.getDate()),e.path.push([n,Se.get(t)[a]]))}Ie.push(e)})),console.log(Ie),t()}))})).then((function(a){var n=d.t("svg"),o=n.append("g").attr("transform","translate(".concat(ve,", ").concat(ge,")")),r=o.append("g").attr("transform","translate(0, ".concat(ye,")"));o.append("g").call(xe),r.transition().duration(2e3).call(je.scale(Oe)).end().then(),n.append("g").attr("id","line").attr("transform","translate(".concat(ve,", ").concat(ge,")"));d.t("#line").selectAll("path").data(e).join("path").attr("fill","none").attr("stroke","black").attr("stroke-width",2.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",(function(t){return console.log("d",Fe(t.path)),Fe(t.path)}));t._animate()}))}},{key:"_animate",value:function(){var t=this,e=function(t){var e=[];return Ie.map((function(a){var n=[];a.path.map((function(e,o){o>t?n.push(a.path[t]):n.push(e)})),e.push({country:a.country,path:n})})),e}(this.state.day);console.log("newData",e),this.setState({linedata:e}),d.t("#line").selectAll("path").data(this.state.linedata).join("path").attr("fill","none").attr("stroke","black").attr("stroke-width",2.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").transition().ease(d.f).duration(500).attr("d",(function(t){return Fe(t.path)})).end().then((function(){t.state.day<68&&(t.state.day+=1,t._animationFrame=window.requestAnimationFrame(t._animate.bind(t)))}))}},{key:"componentWillUnmount",value:function(){this._animationFrame&&window.cancelAnimationFrame(this._animationFrame)}},{key:"render",value:function(){return o.a.createElement(n.Fragment,null,o.a.createElement("svg",{height:500,width:960},o.a.createElement("g",{transform:"translate(".concat(ve,",").concat(ge,")")})))}}]),e}(n.Component),Me=document.getElementById("map");i.a.render(o.a.createElement((function(){return o.a.createElement(l.a,null,o.a.createElement(c.c,null,o.a.createElement(c.a,{exact:!0,path:"/"},o.a.createElement(Mt,null)),o.a.createElement(c.a,{path:"/covid"},o.a.createElement(Xt,null)),o.a.createElement(c.a,{path:"/airquality"},o.a.createElement(ee,null)),o.a.createElement(c.a,{path:"/city"},o.a.createElement(x,null)),o.a.createElement(c.a,{path:"/stream"},o.a.createElement(ce,null)),o.a.createElement(c.a,{path:"/bar"},o.a.createElement(me,null)),o.a.createElement(c.a,{path:"/line"},o.a.createElement(De,null))))}),null),Me)}},[[326,1,2]]]);
//# sourceMappingURL=main.cf200edd.chunk.js.map